window.__require=function t(e,n,i){function a(o,s){if(!n[o]){if(!e[o]){var c=o.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+o+"'")}}var _=n[o]={exports:{}};e[o][0].call(_.exports,function(t){return a(e[o][1][t]||t)},_,_.exports,t,e,n,i)}return n[o].exports}for(var r="function"==typeof __require&&__require,o=0;o<i.length;o++)a(i[o]);return a}({BattleData:[function(t,e,n){"use strict";cc._RF.push(e,"955d2BduEZLo4sLouke/Rkm","BattleData");var i=t("../Manager/ConfigManager"),a=t("../common/BattleUtils");cc.Class({properties:{_initCard:[],_haveYellowCard:!0,_havaRedCard:!0,_redCardLevelsByStep:[],_blueCardShowCfg:[],_yellowCardShowCfg:[],_redCardShowCfg:[]},ctor:function(t){console.log("BattleData.challengeID: ",t);var e=this,n=i.getInstance().Challenge[String(t)];function r(t,n){n.split(";").forEach(function(n){for(var i=n.split("|"),a=0;a<i[0];a++)e._initCard.push([t,Number(i[1])])})}console.log(n),r(a.CARD_TYPE.BLUE,n.initBlueCard),r(a.CARD_TYPE.YELLOW,n.initYellowCard),r(a.CARD_TYPE.RED,n.initRedCard);for(var o=Math.floor(this._initCard.length/2),s=0;s<o;s++){var c=Math.floor(Math.random()*o),l=c+o,_=[this._initCard[l],this._initCard[c]];this._initCard[c]=_[0],this._initCard[l]=_[1]}this._redCardLevelsByStep=n.redCardLevels.split(";"),this._blueCardShowCfg=i.getInstance().HeroDisplay[String(n.blueCardConfigID)],this._yellowCardShowCfg=i.getInstance().HeroDisplay[String(n.yellowCardConfigID)],this._redCardShowCfg=i.getInstance().HeroDisplay[String(n.redCardConfigID)]},getInitCard:function(){return this._initCard}}),cc._RF.pop()},{"../Manager/ConfigManager":"ConfigManager","../common/BattleUtils":"BattleUtils"}],BattleDefine:[function(t,e,n){"use strict";cc._RF.push(e,"dbee0MdtfFKJ4+NWSJil15a","BattleDefine"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],BattleManager:[function(t,e,n){"use strict";cc._RF.push(e,"17d1a6iow5DTKt8n7rSge8H","BattleManager");var i=t("../common/BattleUtils"),a=t("./BattleData");cc.Class({properties:{_arrCard:null,_arrCardOriginalPoint:null,_score:0,_redCount:0,_stepCount:0,_battle:null,_battleConfig:null,_redCardMaxLevel:2},ctor:function(t){this._arrCard=[],this._arrCardOriginalPoint=[],this._score=0,this._redCount=0,this._stepCount=0,this._battle=t,this._redCardMaxLevel=2,this._battleConfig=new a(1)},getConfig:function(){return this._battleConfig},pushcard:function(t,e){this._arrCard[t]=e,this._arrCardOriginalPoint[t]=new cc.Vec2(e.x,e.y)},getCardByIndex:function(t){return this._arrCard[t]},getCardImage:function(t,e){var n=null;if(t==i.CARD_TYPE.RED?n=this._battleConfig._redCardShowCfg["level"+e]:t==i.CARD_TYPE.YELLOW?n=this._battleConfig._yellowCardShowCfg["level"+e]:t==i.CARD_TYPE.BLUE&&(n=this._battleConfig._blueCardShowCfg["level"+e]),!n||0==n.length)return null;var a=n[0];n.length>1&&(a=n[Math.floor(Math.random()*n.length)]);return"res/CardImg/"+a},getScore:function(){return this._score},getRed:function(){return this._redCount},getStep:function(){return this._stepCount},checkMove:function(t,e){var n=i.getPointByIndex(t);if(e==i.CARD_MOVE_DIR.TOP){if(n.y==i.Y-1)return i.MOVE_RES.OVERSTEP;n.y+=1}else if(e==i.CARD_MOVE_DIR.BOTTOM){if(0==n.y)return i.MOVE_RES.OVERSTEP;n.y-=1}else if(e==i.CARD_MOVE_DIR.LEFT){if(0==n.x)return i.MOVE_RES.OVERSTEP;n.x-=1}else if(e==i.CARD_MOVE_DIR.RIGHT){if(n.x==i.X-1)return i.MOVE_RES.OVERSTEP;n.x+=1}var a=i.getIndexByPoint(n),r=this._arrCard[t],o=this._arrCard[a],s=r.getComponent("Card").getCardInfo(),c=o.getComponent("Card").getCardInfo(),l=s[0],_=s[1],h=c[0],d=c[1];return l==i.CARD_TYPE.YELLOW?_==d&&h==i.CARD_TYPE.YELLOW?i.MOVE_RES.YELLOW_COMBINE:i.MOVE_RES.INVALID:l==i.CARD_TYPE.BLUE?h==i.CARD_TYPE.BLUE&&_==d?i.MOVE_RES.BLUE_COMBINE:h==i.CARD_TYPE.RED&&_>=d?i.MOVE_RES.BLUE_RED:h==i.CARD_TYPE.YELLOW&&_>=d?i.MOVE_RES.BLUE_YELLOW:i.MOVE_RES.INVALID:i.MOVE_RES.INVALID},actionMove:function(t,e,n){},moveCard:function(t,e){var n=this._arrCard[t];n.getComponent("Card").setPoint(this._arrCardOriginalPoint[e]),n.getComponent("Card").resetIndex(e),this._arrCard[e]=this._arrCard[t]},setCard:function(t,e){this._arrCard[t]=e},getPointByIndex:function(t){return this._arrCardOriginalPoint[t]},eatCard:function(t,e){console.log("eatCard",t,e),t==i.CARD_TYPE.YELLOW?this._score+=e:t==i.CARD_TYPE.RED&&(this._redCount+=e)},getRandomCardType:function(){var t=Math.floor(101*Math.random());if(t<=40)return[i.CARD_TYPE.YELLOW,1];if(t<=76)return[i.CARD_TYPE.BLUE,1];this._redCardMaxLevel<10&&this._stepCount>this._battleConfig._redCardLevelsByStep[this._redCardMaxLevel]&&(this._redCardMaxLevel+=1);var e=this._redCardMaxLevel;return t>95&&(e=this._redCardMaxLevel-1),[i.CARD_TYPE.RED,e]},generateCard:function(t,e){this._stepCount+=1,this._battle.generateCard(t,e)},checkGameOver:function(){return!!checkGameOver_CantMove()},checkGameOver_CantMove:function(){for(var t=this._arrCard.length,e=0;e<t;++e){var n=this._arrCard[e].getComponent("Card").getIndex(),a=this.checkMove(n,i.CARD_MOVE_DIR.TOP);if(i.checkMoveValid(a))return!1;if(a=this.checkMove(n,i.CARD_MOVE_DIR.RIGHT),i.checkMove(a))return!1}return!0}}),cc._RF.pop()},{"../common/BattleUtils":"BattleUtils","./BattleData":"BattleData"}],BattleUtils:[function(t,e,n){"use strict";cc._RF.push(e,"bd5a9xU2L5L2JbUR6lX3Mxa","BattleUtils"),n.X=5,n.Y=5,n.MOVE_RES={INVALID:-2,OVERSTEP:-1,YELLOW_COMBINE:1,BLUE_COMBINE:2,BLUE_YELLOW:3,BLUE_RED:4},n.CARD_TYPE={BLUE:0,YELLOW:1,RED:2},n.CARD_MOVE_DIR={STAND:0,TOP:1,BOTTOM:2,LEFT:3,RIGHT:4,INVALID:5},n.CARD_Z_ORDER={DEFAULT:0,MOVE:1},n.CARD_COLOR=[new cc.Color(81,151,213,255),new cc.Color(233,198,68,255),new cc.Color(178,68,53,255)],n.getPointByIndex=function(t){return{x:t%5,y:Math.floor(t/5)}},n.getIndexByPoint=function(t){return 5*t.y+t.x},n.getToIndexByDir=function(t,e){var n=this.getPointByIndex(t);return e==this.CARD_MOVE_DIR.TOP?n.y+=1:e==this.CARD_MOVE_DIR.BOTTOM?n.y-=1:e==this.CARD_MOVE_DIR.LEFT?n.x-=1:e==this.CARD_MOVE_DIR.RIGHT&&(n.x+=1),this.getIndexByPoint(n)},n.checkMoveValid=function(t){return t==this.MOVE_RES.YELLOW_COMBINE||t==this.MOVE_RES.BLUE_COMBINE||t==this.MOVE_RES.BLUE_YELLOW||t==this.MOVE_RES.BLUE_RED},cc._RF.pop()},{}],Battle:[function(t,e,n){"use strict";cc._RF.push(e,"b843aSHl+BJAYuw9YxjmR25","Battle");var i=t("../common/BattleUtils"),a=t("../Battle/BattleManager");cc.Class({extends:cc.Component,properties:{lbStep:{default:null,type:cc.Label},lbScore:{default:null,type:cc.Label},lbRed:{default:null,type:cc.Label},lbBest:{default:null,type:cc.Label},cardPanel:{default:null,type:cc.Node},cardPb:{default:null,type:cc.Prefab},_battleManager:null},start:function(){this.lbScore.string="",this.lbBest.string="",this._battleManager=new a(this),this.initGame()},initGame:function(){for(var t=this._battleManager.getConfig().getInitCard(),e=0;e<t.length;e++){var n=i.getPointByIndex(e),a=cc.instantiate(this.cardPb);a.x=140*n.x,a.y=190*n.y,a.getComponent("Card").setData(this._battleManager,e,t[e][0],t[e][1]),this.cardPanel.addChild(a),this._battleManager.pushcard(e,a)}},generateCard:function(t,e){this.refreshScore();var n=this._battleManager.getRandomCardType(),a=cc.instantiate(this.cardPb),r=this._battleManager.getPointByIndex(t);a.x=r.x,a.y=r.y,a.getComponent("Card").setData(this._battleManager,t,n[0],n[1]);var o=new cc.v2(r.x,r.y);e==i.CARD_MOVE_DIR.TOP?o.y-=230:e==i.CARD_MOVE_DIR.BOTTOM?o.y+=230:e==i.CARD_MOVE_DIR.LEFT?o.x+=180:e==i.CARD_MOVE_DIR.RIGHT&&(o.x-=180),a.x=o.x,a.y=o.y,a.getComponent("Card").setPoint(r),this.cardPanel.addChild(a),this._battleManager.setCard(t,a)},refreshScore:function(){this.lbScore.string=this._battleManager.getScore(),this.lbRed.string=this._battleManager.getRed(),this.lbStep.string=this._battleManager.getStep()}}),cc._RF.pop()},{"../Battle/BattleManager":"BattleManager","../common/BattleUtils":"BattleUtils"}],CardData:[function(t,e,n){"use strict";cc._RF.push(e,"b2078W/pnJLF5I+wZjUwWTP","CardData");cc.Class({properties:{_type:0},ctor:function(t){this._type=t}});cc._RF.pop()},{}],Card:[function(t,e,n){"use strict";cc._RF.push(e,"84081r1/31HxIdED/fX+/tT","Card");var i=t("../common/BattleUtils");cc.Class({extends:cc.Component,properties:{lbIndex:{default:null,type:cc.Label},lbLevel:{default:null,type:cc.Label},spHero:{default:null,type:cc.Sprite},_index:0,_type:0,_level:0,_moveDir:0,_moveRes:0,_battleManager:null,_originPoint:null},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouch,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouch,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouch,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouch,this)},onTouch:function(t){var e=t.type;if("touchstart"==e);else if("touchmove"==e){if(console.log("===touchMove",this._moveDir),this._moveDir==i.CARD_MOVE_DIR.INVALID)return void console.log("===",this._index,i.CARD_MOVE_DIR.INVALID);if(this._moveDir==i.CARD_MOVE_DIR.STAND){var n=t.touch.getStartLocation(),a=t.touch.getLocation(),r=a.x-n.x,o=a.y-n.y,s=Math.abs(r),c=Math.abs(o),l=i.getPointByIndex(this._index);console.log("opt",l.x,l.y),(s>20||c>20)&&(s>c?r>0?this.setMoveDir(i.CARD_MOVE_DIR.RIGHT):this.setMoveDir(i.CARD_MOVE_DIR.LEFT):o>0?this.setMoveDir(i.CARD_MOVE_DIR.TOP):this.setMoveDir(i.CARD_MOVE_DIR.BOTTOM))}else{var _=t.touch.getStartLocation(),h=t.touch.getLocation(),d=new cc.Vec2(0,0);if(this._moveDir==i.CARD_MOVE_DIR.TOP){var C=h.y-_.y;C>0&&C<180&&(d.y+=C)}else if(this._moveDir==i.CARD_MOVE_DIR.BOTTOM){var g=h.y-_.y;g<0&&g>-180&&(d.y+=g)}else if(this._moveDir==i.CARD_MOVE_DIR.LEFT){var u=h.x-_.x;u<0&&u>-150&&(d.x+=u)}else if(this._moveDir==i.CARD_MOVE_DIR.RIGHT){var f=h.x-_.x;f>0&&f<150&&(d.x+=f)}this.node.x=this._originPoint.x+d.x,this.node.y=this._originPoint.y+d.y,this.node.zIndex=i.CARD_Z_ORDER.MOVE}}else if("touchend"==e||"touchcancel"==e){var R=!1,E=t.touch.getStartLocation(),D=t.touch.getLocation(),M=D.x-E.x,v=D.y-E.y,O=Math.abs(M),p=Math.abs(v);(O>20||p>20)&&"touchend"==e&&i.checkMoveValid(this._moveDir)&&(this.actionMoveOne(),R=!0),R||(this.node.zIndex=i.CARD_Z_ORDER.DEFAULT,this.node.x=this._originPoint.x,this.node.y=this._originPoint.y,this.node.zIndex=i.CARD_Z_ORDER.STAND)}else this._moveDir=i.CARD_MOVE_DIR.STAND},setMoveDir:function(t){var e=this._battleManager.checkMove(this._index,t);if(i.checkMoveValid(e))return this._moveRes=e,void(this._moveDir=t)},start:function(){},setData:function(t,e,n,a){this._index=e,this._battleManager=t,this._type=n,this._level=a,this.node.color=i.CARD_COLOR[this._type],this.lbLevel.string=this._level,this.lbIndex.string=e,this._originPoint=new cc.Vec2(this.node.x,this.node.y),this._moveRes=i.MOVE_RES.INVALID;var r=this._battleManager.getCardImage(this._type,this._level),o=this;r&&cc.loader.loadRes(r,cc.SpriteFrame,function(t,e){t||(o.spHero.spriteFrame=e)})},acLevelUP:function(){console.log("acLevelUP",this._index,this._type),this._level+=1,this.lbLevel.string=this._level},resetIndex:function(t){console.log("resetIndex",this._index+"->"+t),this._index=t,this.lbIndex.string=this._index,this.node.zIndex=i.CARD_Z_ORDER.DEFAULT,this._moveDir=i.CARD_MOVE_DIR.STAND,this._moveRes=i.MOVE_RES.INVALID},acBeEated:function(){this.node.destroy()},acMoveOneGrid:function(t){},acMoveTo:function(t,e){this.resetIndex(t),this.node.x=e.x,this.node.y=e.y},acMove:function(t){},setPoint:function(t){console.log("setPoint",this._originPoint,t),this._originPoint.x=t.x,this._originPoint.y=t.y;var e=new cc.moveTo(.2,cc.v2(t.x,t.y));this.node.runAction(e)},acDisappear:function(){this._battleManager.setCard(this._index,null),this.node.destroy()},getIndex:function(){return this._index},getCardInfo:function(){return[this._type,this._level]},getOriginalPoint:function(){return this._originPoint},actionMoveOne:function(){var t=i.getPointByIndex(this._index),e=i.getToIndexByDir(this._index,this._moveDir),n=this._battleManager.getCardByIndex(e).getComponent("Card"),a=(n.getOriginalPoint(),this._moveDir);if(this._moveRes==i.MOVE_RES.BLUE_COMBINE&&(n.acLevelUP(),this.acDisappear()),this._moveRes==i.MOVE_RES.YELLOW_COMBINE&&(n.acLevelUP(),this.acDisappear()),this._moveRes==i.MOVE_RES.BLUE_RED){var r=n.getCardInfo();this._battleManager.eatCard(r[0],r[1]),n.acDisappear(),this._battleManager.moveCard(this._index,e)}if(this._moveRes==i.MOVE_RES.BLUE_YELLOW){var o=n.getCardInfo();this._battleManager.eatCard(o[0],o[1]),n.acDisappear(),this._battleManager.moveCard(this._index,e)}var s=t,c=0,l=0;if(a==i.CARD_MOVE_DIR.TOP){for(var _=s.y-1;_>=0;_--){s.y=_;var h=i.getIndexByPoint(s);s.y=_+1;var d=i.getIndexByPoint(s);this._battleManager.moveCard(h,d),console.log(h,d)}s.y=0,l=i.CARD_MOVE_DIR.TOP,c=i.getIndexByPoint(s)}if(a==i.CARD_MOVE_DIR.BOTTOM){for(_=s.y+1;_<i.Y;++_){s.y=_;var C=i.getIndexByPoint(s);s.y=_-1;var g=i.getIndexByPoint(s);this._battleManager.moveCard(C,g),console.log(C,g)}s.y=i.Y-1,l=i.CARD_MOVE_DIR.BOTTOM,c=i.getIndexByPoint(s)}if(a==i.CARD_MOVE_DIR.LEFT){for(_=s.x+1;_<i.X;++_){s.x=_;var u=i.getIndexByPoint(s);s.x=_-1;var f=i.getIndexByPoint(s);this._battleManager.moveCard(u,f),console.log(u,f)}s.x=i.X-1,l=i.CARD_MOVE_DIR.LEFT,c=i.getIndexByPoint(s)}if(a==i.CARD_MOVE_DIR.RIGHT){for(_=s.x-1;_>=0;--_){s.x=_;var R=i.getIndexByPoint(s);s.x=_+1;var E=i.getIndexByPoint(s);this._battleManager.moveCard(R,E),console.log(R,E)}s.x=0,l=i.CARD_MOVE_DIR.RIGHT,c=i.getIndexByPoint(s)}console.log("gen",c,l),this._battleManager.generateCard(c,l)}}),cc._RF.pop()},{"../common/BattleUtils":"BattleUtils"}],ConfigManager:[function(t,e,n){"use strict";cc._RF.push(e,"0b7c5Algf1FL5GIEK6qlQJ+","ConfigManager");var i=["Dict","GameConfig","Trigger","HeroDisplay","Challenge"],a=cc.Class({statics:{_instance:null},properties:{_init:!1,Dict:null,GameConfig:null,Trigger:null,HeroDisplay:null,Challenge:null,configList:{type:Array,default:[]}},start:function(){},loadConfig:function(t){var e=this,n=i.length,a=0;i.forEach(function(i){var r="config/"+i;cc.loader.loadRes(r,function(i,r){i?console.log("load config "+r._name+" failed!"):(e[r._name]=r.json,++a==n&&(e._init=!0),console.log("load config "+r._name+" success!"),t(a,n))})})},init:function(){console.log("ConfigManager init")}});a.getInstance=function(){return this._instance||(this._instance=new a),a._instance},e.exports=a,cc._RF.pop()},{}],Game:[function(t,e,n){"use strict";cc._RF.push(e,"280c3rsZJJKnZ9RqbALVwtK","Game");var i=t("./Manager/ConfigManager");cc.Class({extends:cc.Component,properties:{battlePb:{default:null,type:cc.Prefab},_startBattle:!1},ctor:function(){},onLoad:function(){},start:function(){},update:function(t){!this._startBattle&&i.getInstance()._init&&(this._startBattle=!0,this.startBattle())},startBattle:function(){var t=cc.instantiate(this.battlePb);this.node.addChild(t)}}),cc._RF.pop()},{"./Manager/ConfigManager":"ConfigManager"}],Manager:[function(t,e,n){"use strict";cc._RF.push(e,"b4392apev1CbI0oBa6QrEbR","Manager");var i=t("./ConfigManager");cc.Class({extends:cc.Component,onLoad:function(){cc.game.addPersistRootNode(this.node),this.initGlobal()},initGlobal:function(){G.configManager=i.getInstance(),G.configManager.loadConfig(function(t,e){})}}),cc._RF.pop()},{"./ConfigManager":"ConfigManager"}]},{},["Battle","BattleData","BattleManager","Card","CardData","Game","ConfigManager","Manager","BattleDefine","BattleUtils"]);